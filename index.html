<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link rel="stylesheet" href="">
</head>

<body>
    <form id="artist-form">
        <label for="artist-input">Search:</label>
        <input type="text" id="artist-input"><br>

        <input id="search" type="submit" value="Search">
    </form>

    <div id="sim-art">

    </div>

    <script>

        //Global Variables

        let bandID;
        let newBand0;
        let newBand1;
        let newBand2;
        let newBand3;
        let newBand4;
        let initArtist = document.getElementById("artist-input").value;



        //authorization code from similar stackoverflow issue answered by spotify employee.

        // Get the hash of the url
        const hash = window.location.hash
            .substring(1)
            .split('&')
            .reduce(function (initial, item) {
                if (item) {
                    var parts = item.split('=');
                    initial[parts[0]] = decodeURIComponent(parts[1]);
                }
                return initial;
            }, {});
        window.location.hash = '';

        // Set token
        let _token = hash.access_token;

        const authEndpoint = 'https://accounts.spotify.com/authorize';

        // Replace with your app's client ID, redirect URI and desired scopes
        const clientId = '2ea8916fc375497c977cf897e6533579';
        const redirectUri = 'https://pierrelampre.github.io/spot/';
        const scopes = [
            'playlist-modify-private',
            'playlist-modify-public',
            'user-top-read'
        ];

        // If there is no token, redirect to Spotify authorization
        if (!_token) {
            window.location = `${authEndpoint}?client_id=${clientId}&redirect_uri=${redirectUri}&scope=${scopes.join('%20')}&response_type=token`;
        }

        //_end stackoverflow auth fix_

        // necessary functions

        function getInitArtist() {

            console.log(initArtist);

            initArtist = document.getElementById("artist-input").value;

            $.ajax({
                url: "https://api.spotify.com/v1/search?query=" + initArtist + "&offset=0&limit=10&type=artist",
                type: "GET",
                beforeSend: function (xhr) { xhr.setRequestHeader('Authorization', 'Bearer ' + _token); },
                success: function (data) {

                    console.log(data);

                    bandID = data.artists.items[0].id;
                }
            });
        }

        function getSimilarArtists() {

            
            $.ajax({
                        url: "https://api.spotify.com/v1/artists/" + bandID + "/related-artists",
                        type: "GET",
                        beforeSend: function (xhr) { xhr.setRequestHeader('Authorization', 'Bearer ' + _token); },
                        success: function (data) {

                            console.log(data);

                            newBand0 = data.artists[0];
                            newBand1 = data.artists[1];
                            newBand2 = data.artists[2];
                            newBand3 = data.artists[3];
                            newBand4 = data.artists[4];

                            console.log(newBand0.name);
                            console.log(newBand1.name);
                            console.log(newBand2.name);
                            console.log(newBand3.name);
                            console.log(newBand4.name);

                        }
                    });
        }

        //functionality for similar artist search

        $("#search").on("click", function (event) {
            event.preventDefault();

            getInitArtist();
            getSimilarArtists();

        })
    </script>
</body>

</html>